---
title: 资管CR测试
---
## 资管V0.3接口端CR记录
瑞志

 1. @AutoWired 注入时最好都用接口进行注入 (同一个父类时，加@Qualifier指明 注入哪个类) 
 2. 用yarn写 配置文件可读性会更好>
 3. 一个项目最好一个流程包（AMS一个， ABS一个）
 4. 把一个流程做成一个对象，把属性放在里面会更好(包ID,  processID 等属性)
 5. BMP 审核的代码还可以再抽象点，通过状态机流转简化流程
 6. 审核希望以后做成基础服务，瑞志配合， AMS、ABS 公用
 
王磊

1. 不用的代码直接删掉(涉及到审核的部分)
2. 字段校验失败，通知前端具体哪个字段？抛出一个异常 or 返回通知消息
3. 抛出异常时需要把异常堆栈打出来
4. request.getUserName()  这句话 可以使用一个UserHandler， 把username 在登录时放到ThreadLocal里，  之后直接get即可
5. 事务跨了远程调用最好使用Executor异步执行TransactionCallBack进行回调去处理事务
6. 不要使用e.printStackTrace() 打印异常栈，最好使用logger.info(e); 记录到日志里
7. 计划和产品是两个聚合根，最好分开单独处理（使用command）, 这里计划下的产品与产品无关系，可以一起处理
8. 异常捕获后需要处理，或者直接不捕获
9. 把所有的表单请求字段拼接起来算一个md5值， 存在redis中，短时间有两条的话， 只处理一条， 前后端都需要处理
10. 幂等性，交易， 多次请求，只有一次回复，前端添加一次请求，如果一定时间没有返回，就再发一次，直到成功。
11. 初始化一个StringBuilider时，直接new StringBuidler即可
12. 时间格式化使用一个时间工具类， 不要直接写在代码里
13. 产品价格生效 和 未生效 公有的代码可以提出来，不要重复
14. 字段命名在不同的类中最好统一一下
15. 枚举直接通过==判断，不用取出code,再用equals判断
16. 产品价格参数校验失败直接抛出参数校验失败的异常
17. 收益率参数的校验还需要补充下
18. 单测需要补充下，主要分支需要覆盖到， 收益率生效，未生效

房杰

1. FeeMode 直接switch , 不用getCode出来在Switch
2. 枚举直接判断，不用getCode 
3. 没用到的变量直接删掉
4. request.getData().validate() 提出来
5. errMsg 做成枚举或者 ErrCode
6. 查出来再更新，  可以在loadById时加悲观锁
7. 查当前审核人的代码 可以抽出来，实现一个接口或者公共类，查询审核人的代码公用
8. 保存产品费用后端需要做校验
9. 删除产品费用是，关联的产品费用进行批量查询
10. 产品费用操作加事务
11. 验证失败直接抛出异常即可
12. new Money (0) 改为 Money.ZERO
13. 一个方法参数里调用另一个方法时，把另一个方法抽出来
14. loadById 的时候改成悲观锁,  update 的时候再释放掉 需要加个事务， 避免并发
15. version 乐观锁,  没怎么用， 对性能要求较高，一致性要求较低时可以用
16. 跑批的时候 可以用乐观锁， 多条机器可以并行的跑时可以用
17. 用jdk8 里的LocalDateTime代替jodaTime

 张波
  1. 与前面三位差不多
